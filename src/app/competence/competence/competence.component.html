<div class="card">
  <div class="professional-container">
    <div class="card-content">
      <h1>Gestion des Compétences</h1>
      
      <!-- Toolbar with modern design -->
      <div class="toolbar">
        <!-- Search Box -->
        <form class="form">
          <button>
            <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="search">
              <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9" stroke="currentColor" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
          <input class="input" 
                 placeholder="Rechercher une compétence..." 
                 required 
                 type="text"
                 [(ngModel)]="globalFilter"
                 (input)="applyFilter($event)"
                 name="search">
          <button *ngIf="globalFilter" class="reset" type="reset" (click)="globalFilter = ''; dt?.filterGlobal('', 'contains')">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </form>
        
        <div class="action-buttons">
          <button pButton icon="pi pi-plus" label="Nouvelle Compétence" 
                  class="p-button-secondary add-button" 
                  (click)="showAddDialog()"></button>
          <button pButton icon="pi pi-file-excel" label="Exporter" 
                  class="p-button-contrast export-button" 
                  (click)="exportCompetences()">
            <span *ngIf="selectedCompetences.length > 0" class="selection-count">
              ({{selectedCompetences.length}})
            </span>
          </button>
        </div>
      </div>
      
      <div class="divider"></div>
      
      <!-- Enhanced Table -->
      <div class="table-container">
        <p-table #dt [value]="competences" selectionMode="multiple" [(selection)]="selectedCompetences"
                [paginator]="true" [rows]="7" [rowsPerPageOptions]="[7, 10, 20]"
                [globalFilterFields]="['nom']"
                styleClass="modern-table" [tableStyle]="{'min-width': '75rem'}">
          
          <ng-template pTemplate="header">
            <tr>
              <th>Référence</th>
              <th>Nom de la Compétence</th>
              <th>Opérations</th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-competence>
            <tr [pSelectableRow]="competence">
              <td>
                <span class="id-badge">COMP-{{ competence.id }}</span>
              </td>
              <td>
                <span class="poste-title">{{ competence.nom }}</span>
              </td>
              <td>
                <div class="action-icons">
                  <button pButton icon="pi pi-pencil" 
                          class="p-button-rounded p-button-text p-button-primary edit-button" 
                          (click)="showEditDialog(competence)" pTooltip="Modifier">
                  </button>
                  <button pButton icon="pi pi-trash" 
                          class="p-button-rounded p-button-text p-button-danger delete-button" 
                          (click)="confirmDelete(competence.id)" pTooltip="Supprimer">
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="3">
                <div class="empty-message">
                  <i class="pi pi-info-circle"></i>
                  Aucune compétence trouvée
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>

  <!-- Boîte de dialogue pour ajouter une compétence -->
  <p-dialog header="Ajouter une Compétence" 
            [(visible)]="addDialogVisible" 
            [modal]="true" 
            [style]="{ width: '25rem' }" 
            [draggable]="false" 
            [resizable]="false"
            [closable]="true" 
            [dismissableMask]="true">
    <form [formGroup]="competenceForm" (ngSubmit)="addCompetence()">
      <div class="form-group" [ngClass]="{'has-error': competenceForm.controls['nom'].invalid && competenceForm.controls['nom'].touched}">
        <label for="nom">Nom de la compétence :</label>
        <input pInputText id="nom" type="text" formControlName="nom" />
        <small class="text-danger" *ngIf="competenceForm.controls['nom'].hasError('required') && competenceForm.controls['nom'].touched">
          Ce champ est obligatoire.
        </small>
      </div>

      <div class="form-actions">
        <button pButton type="button" (click)="addDialogVisible = false" class="p-button-text" severity="danger">Annuler</button>
        <button pButton type="submit" [disabled]="competenceForm.invalid" severity="contrast" class="p-button-text">Ajouter</button>
      </div>
    </form>
  </p-dialog>

  <!-- Boîte de dialogue pour modifier une compétence -->
  <p-dialog header="Modifier la Compétence" 
            [(visible)]="editDialogVisible" 
            [modal]="true" 
            [style]="{ width: '25rem' }" 
            [position]="'center'">
    <form [formGroup]="editCompetenceForm" (ngSubmit)="updateCompetence()">
      <div class="form-group" [ngClass]="{'has-error': editCompetenceForm.controls['nom'].invalid && editCompetenceForm.controls['nom'].touched}">
        <label for="editNom">Nom de la compétence :</label>
        <input pInputText id="editNom" type="text" formControlName="nom" />
        <small class="text-danger" *ngIf="editCompetenceForm.controls['nom'].hasError('required') && editCompetenceForm.controls['nom'].touched">
          Ce champ est obligatoire.
        </small>
      </div>

      <div class="form-actions">
        <button pButton type="button" (click)="editDialogVisible = false" class="p-button-text" severity="danger">Annuler</button>
        <button pButton type="submit" [disabled]="editCompetenceForm.invalid" severity="success" class="p-button-text">Enregistrer</button>
      </div>
    </form>
  </p-dialog>

  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>